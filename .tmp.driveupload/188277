import{s as _,a as o,j as e}from"./index-BzW9ot81.js";function A(t){const s=t?.message||t?.error_description||t?.hint||t?.details||"Unknown error";return new Error(s)}async function T(t,{tries:s=3,delayMs:n=300}={}){let d;for(let a=0;a<s;a++)try{return await t()}catch(i){d=i;const c=i?.code||i?.status||0;if(!(i?.name==="TypeError"||c===0||c===429||c>=500&&c<600)||a===s-1)break;await new Promise(m=>setTimeout(m,n*(a+1)))}throw d}async function R({q:t="",status:s="ALL",from:n=0,to:d=24}={}){return T(async()=>{let a=_.from("loads").select("id, reference, customer, broker, status, origin_city, origin_state, dest_city, dest_state, eta, created_at",{count:"exact"}).order("created_at",{ascending:!1}).range(n,d);s!=="ALL"&&(a=a.eq("status",s)),t&&(a=a.or(`reference.ilike.%${t}%,customer.ilike.%${t}%,broker.ilike.%${t}%,origin_city.ilike.%${t}%,dest_city.ilike.%${t}%`));const{data:i,error:c,count:f}=await a;if(c)throw A(c);return{rows:i??[],count:f??0}})}const y=25,C=["ALL","AVAILABLE","IN_TRANSIT","DELIVERED","CANCELLED","AT_RISK","PROBLEM"];function w(...t){return t.filter(Boolean).join(" ")}function M(t,s=300){const[n,d]=o.useState(t);return o.useEffect(()=>{const a=setTimeout(()=>d(t),s);return()=>clearTimeout(a)},[t,s]),n}function D(){const[t,s]=o.useState([]),[n,d]=o.useState(!0),[a,i]=o.useState(""),[c,f]=o.useState(""),m=M(c,300),[b,N]=o.useState("ALL"),[l,j]=o.useState(1),[p,v]=o.useState(0),h=o.useMemo(()=>Math.max(1,Math.ceil(p/y)),[p]);async function g(){d(!0),i("");try{const r=(l-1)*y,E=r+y-1,{rows:L,count:S}=await R({q:m,status:b,from:r,to:E});s(L),v(S)}catch(r){i(r.message||"Failed to load")}finally{d(!1)}}return o.useEffect(()=>{j(1)},[m,b]),o.useEffect(()=>{g()},[m,b,l]),o.useEffect(()=>{function r(){g()}return window.addEventListener("loads:refresh",r),()=>window.removeEventListener("loads:refresh",r)},[]),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-2",children:[e.jsx("input",{value:c,onChange:r=>f(r.target.value),placeholder:"Search reference, customer, broker, city…",className:"w-full md:w-80 rounded-xl border px-3 py-2 bg-white dark:bg-neutral-950 dark:border-neutral-800"}),e.jsx("select",{value:b,onChange:r=>N(r.target.value),className:"rounded-xl border px-3 py-2 bg-white dark:bg-neutral-950 dark:border-neutral-800",children:C.map(r=>e.jsx("option",{value:r,children:r},r))}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsx("button",{onClick:()=>g(),className:"rounded-xl border px-3 py-2 text-sm hover:bg-gray-50 dark:hover:bg-neutral-900 dark:border-neutral-800",title:"Refresh",children:"Refresh"})})]}),n&&e.jsx("div",{className:"rounded-2xl border dark:border-neutral-800 p-6 animate-pulse",children:"Loading…"}),!n&&a&&e.jsxs("div",{className:"rounded-2xl border border-red-300/40 dark:border-red-900/40 bg-red-50/50 dark:bg-red-950/20 p-6",children:[e.jsx("div",{className:"font-medium text-red-700 dark:text-red-200",children:"Error"}),e.jsx("div",{className:"text-sm opacity-80",children:a}),e.jsx("button",{onClick:()=>g(),className:"mt-3 rounded-xl border px-3 py-1 text-sm",children:"Retry"})]}),!n&&!a&&t.length===0&&e.jsxs("div",{className:"rounded-2xl border dark:border-neutral-800 p-6",children:[e.jsx("div",{className:"font-medium",children:"No loads found"}),e.jsx("div",{className:"text-sm opacity-70",children:"Try clearing filters or adding data."})]}),!n&&!a&&t.length>0&&e.jsx("div",{className:"rounded-2xl border dark:border-neutral-800 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-neutral-900",children:e.jsxs("tr",{children:[e.jsx(u,{children:"Reference"}),e.jsx(u,{children:"Customer"}),e.jsx(u,{children:"Broker"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Origin"}),e.jsx(u,{children:"Destination"}),e.jsx(u,{children:"ETA"})]})}),e.jsx("tbody",{children:t.map(r=>e.jsxs("tr",{className:"border-t dark:border-neutral-800 hover:bg-gray-50/50 dark:hover:bg-neutral-900/50",children:[e.jsx(x,{className:"font-medium",children:r.reference||"—"}),e.jsx(x,{children:r.customer||"—"}),e.jsx(x,{children:r.broker||"—"}),e.jsx(x,{children:r.status||"—"}),e.jsx(x,{children:k(r.origin_city,r.origin_state)}),e.jsx(x,{children:k(r.dest_city,r.dest_state)}),e.jsx(x,{children:$(r.eta)})]},r.id))})]})}),!n&&h>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm opacity-70",children:["Page ",l," of ",h," • ",p," loads"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>j(r=>Math.max(1,r-1)),disabled:l===1,className:w("rounded-xl border px+3 py-1 text-sm",l===1&&"opacity-50 cursor-not-allowed"),children:"Prev"}),e.jsx("button",{onClick:()=>j(r=>Math.min(h,r+1)),disabled:l===h,className:w("rounded-xl border px-3 py-1 text-sm",l===h&&"opacity-50 cursor-not-allowed"),children:"Next"})]})]})]})}function u({children:t}){return e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:t})}function x({children:t,className:s=""}){return e.jsx("td",{className:w("p-3 align-top whitespace-nowrap",s),children:t})}function k(t,s){const n=t||"",d=s?n?`, ${s}`:s:"";return n||d?`${n}${d}`:"—"}function $(t){if(!t)return"—";try{return new Date(t).toLocaleString()}catch{return String(t)}}export{D as default};
