import{a as s,j as e,s as N}from"./index-BzW9ot81.js";import{U as y}from"./users-EYTaPwV8.js";import{R as S}from"./refresh-cw-DPQ-WWEq.js";import{P as C}from"./plus-DHvtPo_h.js";import{T as D}from"./triangle-alert-B-As14Wm.js";import{L as E}from"./loader-circle-BqLNAlLR.js";function _({open:t,onClose:m,onCreated:p}){const[o,u]=s.useState(""),[x,h]=s.useState(""),[d,i]=s.useState("dispatcher"),[r,c]=s.useState(!1),[g,f]=s.useState("");if(s.useEffect(()=>{t&&(u(""),h(""),i("dispatcher"),f(""),c(!1))},[t]),!t)return null;async function k(a){a.preventDefault(),c(!0),f("");try{const{data:{session:b}}=await N.auth.getSession();if(!b?.access_token)throw new Error("Not authenticated.");const j=await fetch("https://tnpesnohwbwpmakvyzpn.supabase.co/functions/v1/invite_user",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.access_token}`},body:JSON.stringify({full_name:o,email:x,role:d})});if(!j.ok){const w=await j.json().catch(()=>({}));throw new Error(w?.error||`Invite failed (${j.status})`)}p?.(),m?.()}catch(b){f(b.message||"Failed to create user.")}finally{c(!1)}}return e.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40 backdrop-blur-sm p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900 p-5",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Invite New User"}),g&&e.jsx("div",{className:"mb-3 rounded-lg border border-red-500/40 bg-red-500/10 px-3 py-2 text-sm text-red-300",children:g}),e.jsxs("form",{onSubmit:k,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Full name"}),e.jsx("input",{className:"w-full rounded-xl border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-3 py-2",value:o,onChange:a=>u(a.target.value),placeholder:"e.g., Jane Doe",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Email"}),e.jsx("input",{type:"email",className:"w-full rounded-xl border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-3 py-2",value:x,onChange:a=>h(a.target.value),placeholder:"jane@company.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Role"}),e.jsxs("select",{className:"w-full rounded-xl border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-3 py-2",value:d,onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"}),e.jsx("option",{value:"dispatcher",children:"Dispatcher"}),e.jsx("option",{value:"viewer",children:"Viewer"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",onClick:m,className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",disabled:r,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:r,className:"rounded-xl bg-black text-white px-4 py-2 hover:bg-black/90 disabled:opacity-60 dark:bg-white dark:text-black dark:hover:bg-white/90",children:r?"Inviting…":"Invite"})]})]})]})})}function A(...t){return t.filter(Boolean).join(" ")}function z(){const[t,m]=s.useState([]),[p,o]=s.useState(!0),[u,x]=s.useState(""),[h,d]=s.useState(!1);s.useEffect(()=>{i()},[]);async function i(){o(!0),x("");try{const{data:r,error:c}=await N.from("v_drivers_active").select("*").order("last_name",{ascending:!0});if(c)throw c;m(r||[])}catch(r){x(r.message||"Failed to load drivers")}finally{o(!1)}}return e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-2xl font-semibold flex items-center gap-2",children:[e.jsx(y,{className:"h-6 w-6"}),"Drivers"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:i,className:"inline-flex items-center gap-2 rounded-xl border px-3 py-2 hover:bg-neutral-50 dark:hover:bg-neutral-900 border-neutral-200 dark:border-neutral-800",title:"Refresh",children:[e.jsx(S,{className:"h-4 w-4"})," Refresh"]}),e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center gap-2 rounded-xl bg-black text-white px-3 py-2 hover:bg-black/90",title:"Add Driver",children:[e.jsx(C,{className:"h-4 w-4"})," Add Driver"]})]})]}),u?e.jsxs("div",{className:"text-sm text-red-600 dark:text-red-400 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"})," ",u]}):null,e.jsx("div",{className:"rounded-2xl border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-900 text-neutral-500",children:e.jsxs("tr",{children:[e.jsx(l,{children:"Name"}),e.jsx(l,{children:"Phone"}),e.jsx(l,{children:"CDL #"}),e.jsx(l,{children:"Class"}),e.jsx(l,{children:"CDL Exp."}),e.jsx(l,{children:"Med Exp."}),e.jsx(l,{children:"Status"})]})}),e.jsx("tbody",{children:p?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-6 text-center",children:e.jsxs("span",{className:"inline-flex items-center gap-2 text-neutral-500",children:[e.jsx(E,{className:"h-4 w-4 animate-spin"}),"Loading drivers…"]})})}):t.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"p-10 text-center text-neutral-500",children:["No drivers yet. Click ",e.jsx("b",{children:"Add Driver"})," to create your first one."]})}):t.map(r=>e.jsxs("tr",{className:"border-t border-neutral-200 dark:border-neutral-800",children:[e.jsxs(n,{children:[e.jsxs("div",{className:"font-medium",children:[r.last_name,", ",r.first_name]}),e.jsx("div",{className:"text-xs text-neutral-500",children:r.email||"—"})]}),e.jsx(n,{children:r.phone||"—"}),e.jsx(n,{className:"font-mono",children:r.license_number}),e.jsx(n,{children:r.license_class||"—"}),e.jsx(n,{children:v(r.license_expiry)}),e.jsx(n,{children:v(r.med_card_expiry)}),e.jsx(n,{children:e.jsx("span",{className:A("px-2 py-1 rounded-md text-xs",r.status==="ACTIVE"&&"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-200",r.status==="INACTIVE"&&"bg-neutral-100 text-neutral-700 dark:bg-neutral-900/40 dark:text-neutral-200",r.status==="SUSPENDED"&&"bg-amber-100 text-amber-700 dark:bg-amber-900/40 dark:text-amber-200"),children:r.status})})]},r.id))})]})})}),e.jsx(_,{open:h,onClose:()=>d(!1),onCreated:()=>{d(!1),i()}})]})}function l({children:t}){return e.jsx("th",{className:"text-left font-medium px-4 py-3",children:t})}function n({children:t}){return e.jsx("td",{className:"px-4 py-3 align-top",children:t})}function v(t){if(!t)return"—";try{return new Date(t).toLocaleDateString()}catch{return"—"}}export{z as default};
